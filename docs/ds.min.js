!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).DragSelect=t()}(this,(function(){"use strict";function e(e,t){for(var s=0;s<t.length;s++){var i=t[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function t(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function s(e){return function(e){if(Array.isArray(e))return i(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var s=Object.prototype.toString.call(e).slice(8,-1);"Object"===s&&e.constructor&&(s=e.constructor.name);if("Map"===s||"Set"===s)return Array.from(e);if("Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return i(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var s=0,i=new Array(t);s<t;s++)i[s]=e[s];return i}var n,o=function(e){if(e instanceof Document)return{top:0,left:0,bottom:0,right:0,width:e.documentElement.clientWidth>0?e.documentElement.clientWidth:window.innerWidth,height:e.documentElement.clientHeight>0?e.documentElement.clientHeight:window.innerHeight};var t=e.getBoundingClientRect();return{top:t.top,left:t.left,bottom:t.bottom,right:t.right,width:e.clientWidth||t.width,height:e.clientHeight||t.height}},l=function(e,t,s){if(!s)return{x:0,y:0};"touches"in s&&"touchend"!==s.type&&(n=s);var i="touches"in s?n.touches[0]:s,l=i.pageX,a=i.pageY,c=o(e),h=r();return{x:(l-c.left-h.x)/t,y:(a-c.top-h.y)/t}},r=function(e){var t={top:document.body.scrollTop>0?document.body.scrollTop:document.documentElement.scrollTop,left:document.body.scrollLeft>0?document.body.scrollLeft:document.documentElement.scrollLeft};return{y:e&&e.scrollTop>=0?e.scrollTop:t.top,x:e&&e.scrollLeft>=0?e.scrollLeft:t.left}},a=function(e,t,s,i,n){var o=l(e,t,n),a=r(e),c=a.x-s.x,h=a.y-s.y,u={};return o.x>i.x-c?(u.x=i.x+s.x,u.w=o.x-i.x+c):(u.x=o.x+a.x,u.w=i.x-o.x-c),o.y>i.y-h?(u.y=i.y+s.y,u.h=o.y-i.y+h):(u.y=o.y+a.y,u.h=i.y-o.y-h),u},c=function(e,t,s){return!!t||e.some((function(e){return s[e]}))},h=function(e,t,s){var i=l(e,t,s),n=o(e),r=function(e){if(e instanceof HTMLDocument)return 0;var t=getComputedStyle(e);return parseInt(t.borderWidth)||0}(e);return n.width+r<=i.x||n.height+r<=i.y},u=function(e,t){return e.style.left="".concat(t.x,"px"),e.style.top="".concat(t.y,"px"),e.style.width="".concat(t.w,"px"),e.style.height="".concat(t.h,"px"),e},d=function(e){return e?!Array.isArray(e)&&(e instanceof HTMLElement||e instanceof SVGElement)?[e]:s(e):[]};return function(){function i(e){var s=this,n=e.area,o=void 0===n?document:n,l=e.autoScrollSpeed,r=void 0===l?1:l,a=e.callback,c=void 0===a?function(){}:a,h=e.customStyles,u=void 0!==h&&h,v=e.hoverClass,f=void 0===v?"ds-hover":v,m=e.multiSelectKeys,y=void 0===m?["ctrlKey","shiftKey","metaKey"]:m,_=e.multiSelectMode,S=void 0!==_&&_,p=e.onDragMove,b=void 0===p?function(){}:p,g=e.onDragStart,k=void 0===g?function(){}:g,C=e.onDragStartBegin,x=void 0===C?function(){}:C,L=e.onElementSelect,w=void 0===L?function(){}:L,E=e.onElementUnselect,P=void 0===E?function(){}:E,I=e.selectableClass,M=void 0===I?"ds-selectable":I,T=e.selectables,U=void 0===T?[]:T,O=e.selectedClass,K=void 0===O?"ds-selected":O,z=e.selector,D=void 0===z?void 0:z,A=e.selectorClass,H=void 0===A?"ds-selector":A,j=e.zoom,B=void 0===j?1:j;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),t(this,"_multiSelectKeyPressed",!1),t(this,"_initialCursorPos",{x:0,y:0}),t(this,"_newCursorPos",{x:0,y:0}),t(this,"_previousCursorPos",{x:0,y:0}),t(this,"_initialScroll",{x:0,y:0}),t(this,"_selected",[]),t(this,"_prevSelected",[]),t(this,"_autoScrollInterval",null),t(this,"_onClick",(function(e){return s.handleClick(e)})),t(this,"_startUp",(function(e){return s.startUp(e)})),t(this,"_handleMove",(function(e){return s.handleMove(e)})),t(this,"_end",(function(e){return s.reset(e,!0)})),t(this,"toArray",d),this.selectedClass=K,this.hoverClass=f,this.selectorClass=H,this.selectableClass=M,this.selectables=[],this._initialSelectables=d(U),this.multiSelectKeys=y,this.multiSelectMode=S,this.autoScrollSpeed=0===r?0:r,this.selectCallback=w,this.unselectCallback=P,this.onDragStartBegin=x,this.moveStartCallback=k,this.moveCallback=b,this.callback=c,this.area=function(e){if(e instanceof HTMLDocument)return e;var t=getComputedStyle(e).position;return"absolute"===t||"relative"===t||"fixed"===t||(e.style.position="relative"),e}(o),this.customStyles=u,this.zoom=B,this.selector=D||function(e,t){var s=document.createElement("div");return s.style.position="absolute",e||(s.style.background="rgba(0, 0, 255, 0.1)",s.style.border="1px solid rgba(0, 0, 255, 0.45)",s.style.display="none",s.style.pointerEvents="none"),(t===document?document.body:t).appendChild(s),s}(this.customStyles,this.area),this.selector.classList.add(this.selectorClass),this.start()}var n,v,f;return n=i,(v=[{key:"_handleSelectables",value:function(e,t,s){for(var i=0;i<e.length;i++){var n=e[i],o=this.selectables.indexOf(n);o<0&&!t?this._addSelectable(n,s):o>-1&&t&&this._removeSelectable(n,o,s)}}},{key:"_addSelectable",value:function(e,t){e.classList.add(this.selectableClass),e.addEventListener("click",this._onClick),this.selectables.push(e),t&&this._selected.indexOf(e)<0&&(e.classList.add(this.selectedClass),this._selected.push(e))}},{key:"_removeSelectable",value:function(e,t,s){e.classList.remove(this.hoverClass),e.classList.remove(this.selectableClass),e.removeEventListener("click",this._onClick),this.selectables.splice(t,1),s&&this._selected.indexOf(e)>-1&&(e.classList.remove(this.selectedClass),this._selected.splice(this._selected.indexOf(e),1))}},{key:"handleClick",value:function(e){if(!this.mouseInteraction&&2!==e.button){var t=e.target;this._multiSelectKeyPressed=c(this.multiSelectKeys,this.multiSelectMode,e),this._multiSelectKeyPressed?this._prevSelected=this._selected.slice():this._prevSelected=[],this.checkIfInsideSelection(!0),this.selectables.indexOf(t)>-1&&this.toggle(t),this._end(e)}}},{key:"start",value:function(){this._handleSelectables(this._initialSelectables),this.area.addEventListener("mousedown",this._startUp),this.area.addEventListener("touchstart",this._startUp,{passive:!1})}},{key:"startUp",value:function(e){if(console.log("Startup!"),"touchstart"===e.type&&e.preventDefault(),2!==e.button&&!h(this.area,this.zoom,e)){if(this.onDragStartBegin(e),this._breaked)return!1;if(this.mouseInteraction=!0,this.selector.style.display="block",this._multiSelectKeyPressed=c(this.multiSelectKeys,this.multiSelectMode,e),this._multiSelectKeyPressed?this._prevSelected=this._selected.slice():this._prevSelected=[],this._getStartingPositions(e),this.checkIfInsideSelection(!0),this.selector.style.display="none",this.moveStartCallback(e),this._breaked)return!1;this.area.removeEventListener("mousedown",this._startUp),this.area.removeEventListener("touchstart",this._startUp,{passive:!1}),this.area.addEventListener("mousemove",this._handleMove),this.area.addEventListener("touchmove",this._handleMove,{passive:!1}),document.addEventListener("mouseup",this._end),document.addEventListener("touchend",this._end)}}},{key:"_getStartingPositions",value:function(e){this._initialCursorPos=this._newCursorPos=l(this.area,this.zoom,e),this._initialScroll=r(this.area);var t={};t.x=this._initialCursorPos.x+this._initialScroll.x,t.y=this._initialCursorPos.y+this._initialScroll.y,t.w=0,t.h=0,u(this.selector,t)}},{key:"handleMove",value:function(e){if(this._newCursorPos=l(this.area,this.zoom,e),this.moveCallback(e),this._breaked)return!1;this.selector.style.display="block",u(this.selector,a(this.area,this.zoom,this._initialScroll,this._initialCursorPos,e)),this.checkIfInsideSelection(null),this._setScrollState(e)}},{key:"checkIfInsideSelection",value:function(e){for(var t,s,i,n,o,l,a,c,h,u,d,v,f,m=!1,y=0,_=this.selectables.length;y<_;y++){var S=this.selectables[y];t=S,s=this.selector,i=this.zoom,n=this.area,o=void 0,l=void 0,a=void 0,c=void 0,h=void 0,u=void 0,d=void 0,v=void 0,f=void 0,o=r(n),l=s.getBoundingClientRect().top/i+o.y,a=s.getBoundingClientRect().left/i+o.x,c=s.offsetHeight,h=s.offsetWidth,u=t.getBoundingClientRect(),d=u.top/i+o.y,v=u.left/i+o.x,f=u.height/i,a<v+u.width/i&&a+h>v&&l<d+f&&c+l>d?(this._handleSelection(S,e),m=!0):this._handleUnselection(S,e)}return m}},{key:"_handleSelection",value:function(e,t){if(e.classList.contains(this.hoverClass)&&!t)return!1;this._selected.includes(e)?this._multiSelectKeyPressed&&this.unselect(e):this.select(e),e.classList.add(this.hoverClass)}},{key:"_handleUnselection",value:function(e,t){if(!e.classList.contains(this.hoverClass)&&!t)return!1;var s=this._selected.includes(e),i=this._prevSelected.includes(e);s&&!i?this.unselect(e):!s&&i&&this.select(e),e.classList.remove(this.hoverClass)}},{key:"select",value:function(e){return!(this._selected.indexOf(e)>-1)&&(this._selected.push(e),e.classList.add(this.selectedClass),this.selectCallback(e),!this._breaked&&e)}},{key:"unselect",value:function(e){return!(this._selected.indexOf(e)<0)&&(this._selected.splice(this._selected.indexOf(e),1),e.classList.remove(this.selectedClass),this.unselectCallback(e),!this._breaked&&e)}},{key:"toggle",value:function(e){return this._selected.includes(e)?this.unselect(e):this.select(e),e}},{key:"_setScrollState",value:function(e){var t=this,s=function(e,t,s){var i=l(e,t,s),n=o(e),r=Math.max(n.width/10,30),a=Math.max(n.height/10,30);return i.y<a?"top":n.height-i.y<a?"bottom":n.width-i.x<r?"right":i.x<r&&"left"}(this.area,this.zoom,e);s?(this._autoScrollInterval&&window.clearInterval(this._autoScrollInterval),this._autoScrollInterval=window.setInterval((function(){t._newCursorPos=l(t.area,t.zoom,e),u(t.selector,a(t.area,t.zoom,t._initialScroll,t._initialCursorPos,e)),t.checkIfInsideSelection(null),function(e,t,s){var i=document&&document.documentElement&&document.documentElement.scrollTop&&document.documentElement,n=e instanceof HTMLDocument?i||document.body:e,o="top"===t&&n.scrollTop>0,l="bottom"===t,r="left"===t&&n.scrollLeft>0,a="right"===t;o?n.scrollTop-=1*s:l?n.scrollTop+=1*s:r?n.scrollLeft-=1*s:a&&(n.scrollLeft+=1*s)}(t.area,s,t.autoScrollSpeed)}))):!s&&this._autoScrollInterval&&(window.clearInterval(this._autoScrollInterval),this._autoScrollInterval=null)}},{key:"reset",value:function(e,t){var s=this;if(this._previousCursorPos=l(this.area,this.zoom,e),document.removeEventListener("mouseup",this._end),document.removeEventListener("touchend",this._end),this.area.removeEventListener("mousemove",this._handleMove),this.area.removeEventListener("touchmove",this._handleMove,{passive:!1}),this.area.addEventListener("mousedown",this._startUp),this.area.addEventListener("touchstart",this._startUp,{passive:!1}),t&&this.callback(this.getSelection(),e),this._breaked)return!1;this.selector.style.width="0",this.selector.style.height="0",this.selector.style.display="none",this._autoScrollInterval&&(window.clearInterval(this._autoScrollInterval),this._autoScrollInterval=null),setTimeout((function(){return s.mouseInteraction=!1}),100)}},{key:"break",value:function(){var e=this;this._breaked=!0,setTimeout((function(){return e._breaked=!1}),100)}},{key:"stop",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2?arguments[2]:void 0;this.reset(!1,i),this.area.removeEventListener("mousedown",this._startUp),this.area.removeEventListener("touchstart",this._startUp,{passive:!1}),document.removeEventListener("mouseup",this._end),document.removeEventListener("touchend",this._end),this._handleSelectables(s(this.selectables),e,t)}},{key:"getSelection",value:function(){return s(this._selected)}},{key:"getCursorPos",value:function(e,t,s){if(!e)return{x:0,y:0};var i=t||!1!==t&&this.area,n=l(i,this.zoom,e),o=s?{x:0,y:0}:r(i);return{x:n.x+o.x,y:n.y+o.y}}},{key:"addSelection",value:function(e,t,s){var i=this;return d(e).forEach((function(e){return i.select(e)})),s||this.addSelectables(e),t&&this.callback(this._selected),this._selected}},{key:"removeSelection",value:function(e,t,s){var i=this;return d(e).forEach((function(e){return i.unselect(e)})),s&&this.removeSelectables(e),t&&this.callback(this._selected),this._selected}},{key:"toggleSelection",value:function(e,t,s){for(var i=d(e),n=0,o=i.length;n<o;n++){var l=i[n];this._selected.indexOf(l)<0?this.addSelection(l,t,s):this.removeSelection(l,t,s)}return this._selected}},{key:"setSelection",value:function(e,t,s){return this.clearSelection(),this.addSelection(e,t,s),this._selected}},{key:"clearSelection",value:function(e){var t=this;return this._selected.slice().forEach((function(e){return t.unselect(e)})),e&&this.callback(this._selected),this._selected}},{key:"addSelectables",value:function(e,t){var s=d(e);return this._handleSelectables(s,!1,t),e}},{key:"getSelectables",value:function(){return this.selectables}},{key:"setSelectables",value:function(e,t,s){return this._handleSelectables(this.getSelectables(),!0,t),this.addSelectables(e,s)}},{key:"removeSelectables",value:function(e,t){var s=d(e);return this._handleSelectables(s,!0,t),e}},{key:"getInitialCursorPosition",value:function(){return this._initialCursorPos}},{key:"getCurrentCursorPosition",value:function(){return this._newCursorPos}},{key:"getPreviousCursorPosition",value:function(){return this._previousCursorPos}},{key:"getCursorPositionDifference",value:function(e){var t=this.getCurrentCursorPosition(),s=e?this.getPreviousCursorPosition():this.getInitialCursorPosition();return{x:t.x-s.x,y:t.y-s.y}}}])&&e(n.prototype,v),f&&e(n,f),i}()}));