!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).DragSelect=t()}(this,(function(){"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function n(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function a(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function l(e,t,n){return(l=a()?Reflect.construct:function(e,t,n){var i=[null];i.push.apply(i,t);var r=new(Function.bind.apply(e,i));return n&&o(r,n.prototype),r}).apply(null,arguments)}function c(e){var t="function"==typeof Map?new Map:void 0;return(c=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,i)}function i(){return l(e,arguments,s(this).constructor)}return i.prototype=Object.create(e.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),o(i,e)})(e)}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function d(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?u(e):t}function h(e){var t=a();return function(){var n,i=s(e);if(t){var r=s(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return d(this,n)}}function f(e,t,n){return(f="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=s(e)););return e}(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(n):r.value}})(e,t,n||e)}function v(e){return function(e){if(Array.isArray(e))return S(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return S(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return S(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var m=function(e,t,n){var i=e.x,r=e.y,s=n.x,o=n.y;return{"+":{x:i+s,y:r+o},"-":{x:i-s,y:r-o},"*":{x:i*s,y:r*o}}[t]},p=function(e){return{x:e.left,y:e.top}},g=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return{left:e.x,top:e.y,right:e.x,bottom:e.y,width:t,height:t}},y=function(){var e,t,n,i;return{y:(null===(e=document.body)||void 0===e?void 0:e.scrollTop)||(null===(t=document.documentElement)||void 0===t?void 0:t.scrollTop)||0,x:(null===(n=document.body)||void 0===n?void 0:n.scrollLeft)||(null===(i=document.documentElement)||void 0===i?void 0:i.scrollLeft)||0}},b=function(e){return!e||e instanceof Document?y():{x:e.scrollLeft>=0?e.scrollLeft:y().x,y:e.scrollTop>=0?e.scrollTop:y().y}},_=function(e){var t=e.elementRect,n=e.containerRect,i=e.tolerance,r=void 0===i?{x:0,y:0}:i,s=[];return t.top-r.y<n.top&&s.push("top"),t.left-r.x<n.left&&s.push("left"),t.bottom+r.y>n.bottom&&s.push("bottom"),t.right+r.y>n.right&&s.push("right"),s},D=function(e){var t=e.event;return{x:t.clientX,y:t.clientY}},k=function(e){var t=window.getComputedStyle(e);if(!t.transform||"none"===t.transform)return{x:0,y:0};if(t.transform.indexOf("3d")>=0){var n=t.transform.match(/(?<=matrix3d\()(.*?),(.*?),(.*?),(.*?),(.*?),(.*?),(.*?),(.*?),(.*?),(.*?),(.*?),(.*?),(.*?),(.*?),(.*?),(.*?)(?=\))/);return{x:parseInt(n[13])||0,y:parseInt(n[14])||0}}var i=t.transform.match(/(?<=matrix\()(.*?),(.*?),(.*?),(.*?),(.*?),(.*?)(?=\))/);return{x:parseInt(i[5])||0,y:parseInt(i[6])||0}},x=function(e,t){return t?function(e){var t=e.style.transform;if(!t||t.indexOf("translate")<0)return k(e);var n=t.indexOf("3d")>=0?/(?<=translate3d\()(.*?),(.*?),(.*?)(?=\))/:/(?<=translate\()(.*?),(.*?)(?=\))/,i=t.match(n),r={x:parseInt(i[1])||0,y:parseInt(i[2])||0};return r.x||r.x?r:k(e)}(e):function(e){var t=e.style,n={x:parseInt(t.left)||0,y:parseInt(t.top)||0};if(!n.x&&!n.x){var i=window.getComputedStyle(e);return{x:parseInt(i.left)||0,y:parseInt(i.top)||0}}return n}(e)},E=function(e,t){return e.left<t.right&&e.right>t.left&&e.top<t.bottom&&e.bottom>t.top},w=function(e){var t=e.element,n=e.posDirection,i=e.containerRect,r=e.useTransform,s=x(t,r),o=m(s,"+",n);I(t,o,r);var a=t.getBoundingClientRect();!function(e){var t=e.element,n=e.edges,i=e.elementRect,r=e.containerRect,s=e.elementPos,o=e.useTransform;n.includes("top")&&I(t,{y:s.y+r.top-i.top,x:s.x},o),n.includes("left")&&I(t,{y:s.y,x:s.x+r.left-i.left},o),n.includes("bottom")&&I(t,{y:s.y+r.bottom-i.bottom,x:s.x},o),n.includes("right")&&I(t,{y:s.y,x:s.x+r.right-i.right},o)}({element:t,edges:_({elementRect:a,containerRect:i}),elementRect:a,containerRect:i,elementPos:o,useTransform:r})},I=function(e,t,n){if(n){var i=e.style.transform;e.style.transform="translate3d(".concat(t.x,"px,").concat(t.y,"px,1px) ").concat(i.replace(/translate.*?\)/g,""))}else e.style.left="".concat(t.x,"px"),e.style.top="".concat(t.y,"px");return e},P=function(e){return e?!Array.isArray(e)&&(e instanceof HTMLElement||e instanceof SVGElement)?[e]:v(e):[]},A=function(e,t){e.style.left="".concat(t.left,"px"),e.style.top="".concat(t.top,"px"),e.style.width="".concat(t.width,"px"),e.style.height="".concat(t.height,"px")},L=function(){function t(n){var r=this,s=n.area,o=n.PS,a=n.zoom;e(this,t),i(this,"_modificationCallback",void 0),i(this,"_modificationObserver",void 0),i(this,"_zoom",void 0),i(this,"_node",void 0),i(this,"_parentNodes",void 0),i(this,"_computedStyle",void 0),i(this,"_computedBorder",void 0),i(this,"_rect",void 0),i(this,"start",(function(){var e,t,n;e=r.parentNodes,t=r._modificationCallback,n=r._modificationObserver,window.addEventListener("resize",t),window.addEventListener("scroll",t),e.forEach((function(e,t){n.observe(e,{childList:0!==t,attributes:!0})}))})),i(this,"reset",(function(){r._computedStyle=void 0,r._rect=void 0,r._computedBorder=void 0,r._parentNodes=void 0})),i(this,"stop",(function(){var e,t;e=r._modificationObserver,t=r._modificationCallback,window.removeEventListener("resize",t),window.removeEventListener("scroll",t),e.disconnect(),r.reset()})),i(this,"scroll",(function(e,t){!function(e,t,n){if(t.length){var i=document&&document.documentElement&&document.documentElement.scrollTop&&document.documentElement,r=e instanceof HTMLDocument?i||document.body:e,s=t.includes("top")&&r.scrollTop>0,o=t.includes("bottom")&&r.scrollTop<r.scrollHeight,a=t.includes("left")&&r.scrollLeft>0,l=t.includes("right")&&r.scrollLeft<r.scrollWidth;s&&(r.scrollTop-=1*n),o&&(r.scrollTop+=1*n),a&&(r.scrollLeft-=1*n),l&&(r.scrollLeft+=1*n)}}(r._node,e,t),r.PubSub.publish("Area:scroll",{data:{directions:e,multiplier:t}})})),this._node=s,this._zoom=a,this.PubSub=o;var l,c,u,d=this.computedStyle.position,h="absolute"===d||"relative"===d||"fixed"===d;this._node instanceof HTMLDocument||h||(this._node.style.position="relative"),this._modificationCallback=(l=function(e){r.reset(),r.PubSub.publish("Area:modified",{event:e,item:r})},c=60,function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=function(){u=null,l.apply(void 0,t)};clearTimeout(u),u=setTimeout(i,c)}),this._modificationObserver=new MutationObserver(this._modificationCallback),setTimeout((function(){r.reset(),r.PubSub.publish("Area:modified",{event:event,item:r})})),this.PubSub.subscribe("Interaction:init",this.start),this.PubSub.subscribe("Interaction:end",this.reset)}return n(t,[{key:"HTMLNode",get:function(){return this._node}},{key:"computedBorder",get:function(){return this._computedBorder?this._computedBorder:{top:parseInt(this.computedStyle.borderTopWidth),bottom:parseInt(this.computedStyle.borderBottomWidth),left:parseInt(this.computedStyle.borderLeftWidth),right:parseInt(this.computedStyle.borderRightWidth)}}},{key:"computedStyle",get:function(){return this._computedStyle?this._computedStyle:this.HTMLNode instanceof HTMLDocument?this._computedStyle=getComputedStyle(this.HTMLNode.body||this.HTMLNode.documentElement):this._computedStyle=getComputedStyle(this.HTMLNode)}},{key:"rect",get:function(){return this._rect?this._rect:this._rect=function(e,t){if(e instanceof Document)return{top:0,left:0,bottom:0,right:0,width:window.innerWidth,height:window.innerHeight};var n=e.getBoundingClientRect();return{top:n.top,left:n.left,bottom:n.bottom,right:n.right,width:e.clientWidth*t,height:e.clientHeight*t}}(this.HTMLNode,this._zoom)}},{key:"parentNodes",get:function(){if(this._parentNodes)return this._parentNodes;return this._parentNodes=function e(t){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=null===(n=t[i])||void 0===n?void 0:n.parentNode;return r?(t.push(r),e(t,++i)):t}([this.HTMLNode]),this._parentNodes}}]),t}(),T=function(){function t(n){var r=this,s=n.DS,o=n.useTransform,a=n.dragKeys,l=n.keyboardDragSpeed;e(this,t),i(this,"_useTransform",void 0),i(this,"_prevCursorPos",void 0),i(this,"_prevScrollPos",void 0),i(this,"_elements",[]),i(this,"_dragKeys",void 0),i(this,"_dragKeysFlat",void 0),i(this,"_keyboardDragSpeed",void 0),i(this,"keyboardDrag",(function(e){var t=e.event,n=e.key;if(r._dragKeysFlat.includes(n)&&r.DS.SelectedSet.size){r._isKeyboard=!0,r.DS.publish("Interaction:start",{event:t,isDragging:!0}),r._elements=r.DS.getSelection(),r.handleZIndex(!0);var i={x:0,y:0},s=r.DS.stores.KeyStore.currentValues.includes("shift")?4*r._keyboardDragSpeed:r._keyboardDragSpeed;r._dragKeys.left.includes(n)&&(i.x=r._scrollDiff.x||-s),r._dragKeys.right.includes(n)&&(i.x=r._scrollDiff.x||s),r._dragKeys.up.includes(n)&&(i.y=r._scrollDiff.y||-s),r._dragKeys.down.includes(n)&&(i.y=r._scrollDiff.y||s),r._elements.forEach((function(e){return w({element:e,posDirection:i,containerRect:r.DS.SelectorArea.rect,useTransform:r._useTransform})})),r.DS.publish("Interaction:update",{event:t,isDragging:!0}),r._isKeyboard=!1}})),i(this,"keyboardEnd",(function(e){var t=e.event,n=e.key;r._dragKeysFlat.includes(n)&&r.DS.SelectedSet.size&&(r._isKeyboard=!0,r.DS.publish("Interaction:end",{event:t,isDragging:!0}),r._isKeyboard=!1)})),i(this,"start",(function(e){e.isDragging&&!r._isKeyboard&&(r._prevCursorPos=null,r._prevScrollPos=null,r._elements=r.DS.getSelection(),r.handleZIndex(!0))})),i(this,"stop",(function(){r._isKeyboard||(r._prevCursorPos=null,r._prevScrollPos=null,r.handleZIndex(!1),r._elements=[])})),i(this,"update",(function(e){if(e.isDragging&&r._elements.length&&!r._isKeyboard){var t=m(r._cursorDiff,"+",r._scrollDiff);r._elements.forEach((function(e){return w({element:e,posDirection:t,containerRect:r.DS.SelectorArea.rect,useTransform:r._useTransform})}))}})),i(this,"handleZIndex",(function(e){r._elements.forEach((function(t){return t.style.zIndex="".concat((parseInt(t.style.zIndex)||0)+e?9999:-9998)}))})),this.DS=s,this._useTransform=o,this._keyboardDragSpeed=l,this._dragKeys={up:a.up.map((function(e){return e.toLowerCase()})),down:a.down.map((function(e){return e.toLowerCase()})),left:a.left.map((function(e){return e.toLowerCase()})),right:a.right.map((function(e){return e.toLowerCase()}))},this._dragKeysFlat=[].concat(v(this._dragKeys.up),v(this._dragKeys.down),v(this._dragKeys.left),v(this._dragKeys.right)),this.DS.subscribe("Interaction:start",this.start),this.DS.subscribe("Interaction:end",this.stop),this.DS.subscribe("Interaction:update",this.update),this.DS.subscribe("KeyStore:down",this.keyboardDrag),this.DS.subscribe("KeyStore:up",this.keyboardEnd)}return n(t,[{key:"_cursorDiff",get:function(){var e=this.DS.stores.PointerStore.currentVal,t=this._prevCursorPos?m(e,"-",this._prevCursorPos):{x:0,y:0};return this._prevCursorPos=e,t}},{key:"_scrollDiff",get:function(){var e=this.DS.stores.ScrollStore.currentVal,t=this._prevScrollPos?m(e,"-",this._prevScrollPos):{x:0,y:0};return this._prevScrollPos=e,t}}]),t}(),V=function(){function t(n){var r=this,s=n.areaElement,o=n.DS,a=n.draggability,l=n.immediateDrag;e(this,t),i(this,"_areaElement",void 0),i(this,"_draggability",void 0),i(this,"_immediateDrag",void 0),i(this,"isInteracting",void 0),i(this,"isDragging",void 0),i(this,"init",(function(){r.stop(),r._areaElement.addEventListener("mousedown",r.start),r._areaElement.addEventListener("touchstart",r.start,{passive:!1}),r.DS.publish("Interaction:init",{})})),i(this,"start",(function(e){"touchstart"===e.type&&e.preventDefault(),r._canInteract(e)&&(r.isInteracting=!0,r.isDragging=r.isDragEvent(e),r.DS.publish("Interaction:start",{event:e,isDragging:r.isDragging}),document.addEventListener("mouseup",r.reset),document.addEventListener("touchend",r.reset))})),i(this,"isDragEvent",(function(e){return!(!r._draggability||r.DS.stores.KeyStore.isMultiSelectKeyPressed(e)||!r.DS.SelectableSet.has(e.target))&&(r._immediateDrag&&(r.DS.SelectedSet.size?r.DS.SelectedSet.has(e.target)||(r.DS.SelectedSet.clear(),r.DS.SelectedSet.add(e.target)):r.DS.SelectedSet.add(e.target)),!!r.DS.SelectedSet.has(e.target))})),i(this,"onClick",(function(e){var t=e.event;if(r._canInteract(t)&&!(t.detail>0)){var n=r.DS,i=n.stores,s=i.PointerStore,o=i.KeyStore,a=n.SelectableSet,l=n.SelectedSet,c=n.publish;s.start(t);var u=t.target;a.has(u)&&(o.isMultiSelectKeyPressed(t)||l.clear(),l.toggle(u),c("Interaction:end",{event:t,isDragging:r.isDragging}))}})),i(this,"stop",(function(){r.isInteracting=!1,r.isDragging=!1,r._areaElement.removeEventListener("mousedown",r.start),r._areaElement.removeEventListener("touchstart",r.start,{passive:!1}),document.removeEventListener("mouseup",r.reset),document.removeEventListener("touchend",r.reset)})),i(this,"update",(function(e){var t=e.event,n=e.data;r.isInteracting&&r.DS.publish("Interaction:update",{event:t,data:n,isDragging:r.isDragging})})),i(this,"reset",(function(e){var t=r.isDragging;r.stop(),r.init(),r.DS.publish("Interaction:end",{event:e,isDragging:t})})),this._areaElement=s,this._draggability=a,this._immediateDrag=l,this.DS=o,this.DS.subscribe("PointerStore:updated",this.update),this.DS.subscribe("Selectable:click",this.onClick),this.DS.subscribe("Selectable:pointer",(function(e){var t=e.event;return r.start(t)})),this.DS.subscribe("Area:scroll",this.update)}return n(t,[{key:"_canInteract",value:function(e){return!(2===e.button||this.isInteracting||e.target&&!this.DS.SelectorArea.isInside(e.target))}}]),t}(),C=function t(){var n=this;e(this,t),i(this,"subscribers",{}),i(this,"subscribe",(function(e,t){return Array.isArray(n.subscribers[e])||(n.subscribers[e]=[]),n.subscribers[e].push(t),n.subscribers[e].length-1})),i(this,"unsubscribe",(function(e,t,i){i>=0?n.subscribers[e].splice(i,1):t&&(n.subscribers[e]=n.subscribers[e].filter((function(e){return e!==t})))})),i(this,"publish",(function(e,t){Array.isArray(n.subscribers[e])&&n.subscribers[e].forEach((function(e){return e(t)}))}))},N=function(t){r(a,t);var o=h(a);function a(t){var n,r=t.elements,s=t.className,l=t.hoverClassName,c=t.DS;return e(this,a),i(u(n=o.call(this)),"_initElements",void 0),i(u(n),"_className",void 0),i(u(n),"_hoverClassName",void 0),i(u(n),"init",(function(){return n._initElements.forEach((function(e){return n.add(e)}))})),i(u(n),"clear",(function(){return n.forEach((function(e){return n.delete(e)}))})),i(u(n),"_onClick",(function(e){return n.DS.publish("Selectable:click",{event:e})})),i(u(n),"_onPointer",(function(e){return n.DS.publish("Selectable:pointer",{event:e})})),i(u(n),"addAll",(function(e){return e.forEach((function(e){return n.add(e)}))})),i(u(n),"deleteAll",(function(e){return e.forEach((function(e){return n.delete(e)}))})),n.DS=c,n._initElements=P(r),n._className=s,n._hoverClassName=l,n.DS.subscribe("Interaction:init",n.init),n}return n(a,[{key:"add",value:function(e){return e.classList.add(this._className),e.addEventListener("click",this._onClick),e.addEventListener("mousedown",this._onPointer),e.addEventListener("touchstart",this._onPointer,{passive:!1}),f(s(a.prototype),"add",this).call(this,e)}},{key:"delete",value:function(e){return e.classList.remove(this._className),e.classList.remove(this._hoverClassName),e.removeEventListener("click",this._onClick),e.removeEventListener("mousedown",this._onPointer),e.removeEventListener("touchstart",this._onPointer,{passive:!1}),f(s(a.prototype),"delete",this).call(this,e)}},{key:"elements",get:function(){return Array.from(this.values())}}]),a}(c(Set)),M=function(t){r(a,t);var o=h(a);function a(t){var n,r=t.className,s=t.DS;return e(this,a),i(u(n=o.call(this)),"_className",void 0),i(u(n),"clear",(function(){return n.forEach((function(e){return n.delete(e)}))})),i(u(n),"addAll",(function(e){return e.forEach((function(e){return n.add(e)}))})),i(u(n),"deleteAll",(function(e){return e.forEach((function(e){return n.delete(e)}))})),n.DS=s,n._className=r,n}return n(a,[{key:"add",value:function(e){if(!f(s(a.prototype),"has",this).call(this,e))return f(s(a.prototype),"add",this).call(this,e),e.classList.add(this._className),this.DS.publish("Selected:added",{items:this.elements,item:e}),e.style.zIndex="".concat((parseInt(e.style.zIndex)||0)+1),this}},{key:"delete",value:function(e){if(f(s(a.prototype),"has",this).call(this,e)){var t=f(s(a.prototype),"delete",this).call(this,e);return e.classList.remove(this._className),this.DS.publish("Selected:removed",{items:this.elements,item:e}),e.style.zIndex="".concat((parseInt(e.style.zIndex)||0)-1),t}}},{key:"toggle",value:function(e){return this.has(e)?this.delete(e):this.add(e),e}},{key:"elements",get:function(){return Array.from(this.values())}}]),a}(c(Set)),K=function(){function t(n){var r=this,s=n.DS,o=n.hoverClassName,a=n.multiSelectToggling;e(this,t),i(this,"_prevSelected",void 0),i(this,"_hoverClassName",void 0),i(this,"_multiSelectToggling",void 0),i(this,"start",(function(e){var t=e.event;e.isDragging||(r._storePrevious(t),r._checkIfInsideSelection(!0,t))})),i(this,"update",(function(e){e.isDragging||r._checkIfInsideSelection()})),i(this,"_checkIfInsideSelection",(function(e,t){for(var n=r.DS,i=n.SelectableSet,s=n.SelectorArea,o=n.Selector,a=i.elements.map((function(e){return[e,e.getBoundingClientRect()]})),l=[],c=[],u=0,d=a.length;u<d;u++)s.isInside(a[u][0],a[u][1])&&(E(a[u][1],o.rect)?l.push(a[u][0]):c.push(a[u][0]));return l.forEach((function(n){return r._handleSelection(n,e,t)})),c.forEach((function(t){return r._handleUnselection(t,e)})),l.length>-1})),this._hoverClassName=o,this._multiSelectToggling=a,this.DS=s,this.DS.subscribe("Interaction:start",this.start),this.DS.subscribe("Interaction:update",this.update)}return n(t,[{key:"_storePrevious",value:function(e){var t=this.DS,n=t.stores.KeyStore,i=t.SelectedSet;n.isMultiSelectKeyPressed(e)?this._prevSelected=new Set(i):this._prevSelected=new Set}},{key:"_handleSelection",value:function(e,t,n){if(e.className.indexOf(this._hoverClassName)>0&&!t)return!1;var i=this.DS,r=i.SelectedSet,s=i.stores.KeyStore;r.has(e)?s.isMultiSelectKeyPressed(n)&&this._multiSelectToggling&&r.delete(e):r.add(e),e.classList.add(this._hoverClassName)}},{key:"_handleUnselection",value:function(e,t){if(e.className.indexOf(this._hoverClassName)<0&&!t)return!1;var n=this.DS.SelectedSet,i=n.has(e),r=this._prevSelected.has(e);i&&!r?n.delete(e):!i&&r&&n.add(e),e.classList.remove(this._hoverClassName)}}]),t}(),O=function(){function t(n){var r=this,s=n.DS,o=n.selector,a=n.selectorClass,l=n.customStyles;e(this,t),i(this,"_rect",void 0),i(this,"start",(function(e){if(!e.isDragging){var t=r.DS.stores.PointerStore.initialValArea;A(r.HTMLNode,g(t,1)),r.HTMLNode.style.display="block",r._rect=null}})),i(this,"stop",(function(){r.HTMLNode.style.width="0",r.HTMLNode.style.height="0",r.HTMLNode.style.display="none"})),i(this,"update",(function(e){if(!e.isDragging){var t=r.DS.stores,n=t.ScrollStore,i=t.PointerStore,s=function(e){var t=e.scrollAmount,n=e.initialPointerPos,i=e.pointerPos,r={};return i.x>n.x-t.x?(r.left=n.x-t.x,r.width=i.x-n.x+t.x):(r.left=i.x,r.width=n.x-i.x-t.x),i.y>n.y-t.y?(r.top=n.y-t.y,r.height=i.y-n.y+t.y):(r.top=i.y,r.height=n.y-i.y-t.y),r}({scrollAmount:n.scrollAmount,initialPointerPos:i.initialValArea,pointerPos:i.currentValArea});A(r.HTMLNode,s),r._rect=null}})),this.DS=s,this.HTMLNode=o||function(e){var t=document.createElement("div");return t.style.position="absolute",e||(t.style.background="rgba(0, 0, 255, 0.1)",t.style.border="1px solid rgba(0, 0, 255, 0.45)",t.style.display="none",t.style.pointerEvents="none"),t}(l),this.HTMLNode.classList.add(a),this.DS.subscribe("Interaction:start",this.start),this.DS.subscribe("Interaction:update",this.update),this.DS.subscribe("Interaction:end",this.stop)}return n(t,[{key:"rect",get:function(){return this._rect?this._rect:this._rect=this.HTMLNode.getBoundingClientRect()}}]),t}(),H=function(){function t(n){var r=this,s=n.DS,o=n.selectorAreaClass,a=n.autoScrollSpeed,l=n.overflowTolerance;e(this,t),i(this,"_autoScrollSpeed",void 0),i(this,"_scrollInterval",void 0),i(this,"_rect",void 0),i(this,"currentEdges",[]),i(this,"_overflowTolerance",void 0),i(this,"updatePos",(function(){r._rect=null;var e=r.DS.Area.rect,t=r.DS.Area.computedBorder,n=r.HTMLNode.style,i="".concat(e.top+t.top,"px"),s="".concat(e.left+t.left,"px"),o="".concat(e.width,"px"),a="".concat(e.height,"px");n.top!==i&&(n.top=i),n.left!==s&&(n.left=s),n.width!==o&&(n.width=o),n.height!==a&&(n.height=a)})),i(this,"startAutoScroll",(function(){r.currentEdges=[],r._scrollInterval=setInterval((function(){return r.handleAutoScroll()}),16)})),i(this,"handleAutoScroll",(function(){var e=r.DS,t=e.stores.PointerStore,n=e.Area;r.currentEdges=_({elementRect:g(t.currentVal),containerRect:r.rect,tolerance:r._overflowTolerance}),r.currentEdges.length&&n.scroll(r.currentEdges,r._autoScrollSpeed)})),i(this,"stopAutoScroll",(function(){r.currentEdges=[],clearInterval(r._scrollInterval)})),i(this,"isInside",(function(e,t){return!(!r.DS.Area.HTMLNode.contains(e)||!r.DS.stores.ScrollStore.canScroll)||E(r.rect,t||e.getBoundingClientRect())})),this._autoScrollSpeed=a,this._overflowTolerance=l,this.DS=s,this.HTMLNode=function(e){var t=document.createElement("div");return t.style.position="fixed",t.style.overflow="hidden",t.style.pointerEvents="none",t.style.zIndex="999999999999999999",t.classList.add(e),t}(o),this.HTMLNode.append(this.DS.Selector.HTMLNode);var c=document.body?"body":"documentElement";document[c].append(this.HTMLNode),this.DS.subscribe("Area:modified",this.updatePos),this.DS.subscribe("Interaction:start",this.startAutoScroll),this.DS.subscribe("Interaction:end",(function(){r.updatePos(),r.stopAutoScroll()}))}return n(t,[{key:"isClicked",value:function(){var e=this.DS.stores.PointerStore;return E({left:e.initialVal.x,top:e.initialVal.y,right:e.initialVal.x,bottom:e.initialVal.y},this.rect)}},{key:"rect",get:function(){return this._rect?this._rect:this._rect=this.HTMLNode.getBoundingClientRect()}}]),t}(),R=function(){function t(n){var r=this,s=n.DS,o=n.multiSelectKeys,a=n.multiSelectMode;e(this,t),i(this,"_multiSelectMode",void 0),i(this,"_multiSelectKeys",void 0),i(this,"_currentValues",new Set),i(this,"_keyMapping",{control:"ctrlKey",shift:"shiftKey",meta:"metaKey"}),i(this,"init",(function(){document.addEventListener("keydown",r.keydown),document.addEventListener("keyup",r.keyup),window.addEventListener("blur",r.reset)})),i(this,"keydown",(function(e){var t=e.key.toLowerCase();r._currentValues.add(t),r.DS.publish("KeyStore:down",{event:e,key:t})})),i(this,"keyup",(function(e){var t=e.key.toLowerCase();r._currentValues.delete(t),r.DS.publish("KeyStore:up",{event:e,key:t})})),i(this,"stop",(function(){document.removeEventListener("keydown",r.keydown),document.removeEventListener("keyup",r.reset),window.removeEventListener("blur",r.reset),r.reset()})),i(this,"reset",(function(){return r._currentValues.clear()})),this.DS=s,this._multiSelectMode=a,this._multiSelectKeys=o.map((function(e){var t={ctrlKey:"Control",shiftKey:"Shift",metaKey:"Meta"}[e];return t?(console.warn("[DragSelect] ".concat(e,' is deprecated. Use "').concat(t,'" instead. Act Now!. See docs for more info')),t.toLowerCase()):e.toLowerCase()})),this.DS.subscribe("Interaction:init",this.init)}return n(t,[{key:"isMultiSelectKeyPressed",value:function(e){var t=this;return!!this._multiSelectMode||(!!this.currentValues.some((function(e){return t._multiSelectKeys.includes(e)}))||!(!e||!this._multiSelectKeys.some((function(n){return e[t._keyMapping[n]]}))))}},{key:"currentValues",get:function(){return Array.from(this._currentValues.values())}}]),t}(),z=function(){function t(n){var r=this,s=n.DS;e(this,t),i(this,"_isMouseInteraction",!1),i(this,"_initialValArea",void 0),i(this,"_currentValArea",void 0),i(this,"_lastValArea",void 0),i(this,"_initialVal",void 0),i(this,"_currentVal",void 0),i(this,"_lastVal",void 0),i(this,"_lastTouch",void 0),i(this,"init",(function(){document.addEventListener("mousemove",r.update),document.addEventListener("touchmove",r.update,{passive:!1})})),i(this,"update",(function(e){e&&(r.currentVal=D({event:r._normalizedEvent(e)}),r._isMouseInteraction&&r.DS.publish("PointerStore:updated",{event:e}))})),i(this,"stop",(function(){document.removeEventListener("mousemove",r.update),document.removeEventListener("touchmove",r.update,{passive:!1}),setTimeout((function(){return r._isMouseInteraction=!1}),100)})),i(this,"reset",(function(e){e&&(r.currentVal=r.lastVal=D({event:r._normalizedEvent(e)}),r.stop(),r.init())})),this.DS=s,this.DS.subscribe("Interaction:init",this.init),this.DS.subscribe("Interaction:start",(function(e){var t=e.event;return r.start(t)})),this.DS.subscribe("Interaction:end",(function(e){var t=e.event;return r.reset(t)}))}return n(t,[{key:"start",value:function(e){e&&(this._isMouseInteraction=!0,this.currentVal=this.initialVal=D({event:this._normalizedEvent(e)}))}},{key:"_normalizedEvent",value:function(e){return"touches"in e&&"touchend"!==e.type&&(this._lastTouch=e),"touches"in e?this._lastTouch.touches[0]:e}},{key:"initialValArea",get:function(){return this._initialValArea?this._initialValArea:{x:0,y:0}}},{key:"currentValArea",get:function(){return this._currentValArea?this._currentValArea:{x:0,y:0}}},{key:"lastValArea",get:function(){return this._lastValArea?this._lastValArea:{x:0,y:0}}},{key:"initialVal",get:function(){return this._initialVal?this._initialVal:{x:0,y:0}},set:function(e){this._initialVal=e,this._initialValArea=e&&m(e,"-",m(p(this.DS.Area.rect),"+",p(this.DS.Area.computedBorder)))}},{key:"currentVal",get:function(){return this._currentVal?this._currentVal:{x:0,y:0}},set:function(e){this._currentVal=e,this._currentValArea=e&&m(e,"-",m(p(this.DS.Area.rect),"+",p(this.DS.Area.computedBorder)))}},{key:"lastVal",get:function(){return this._lastVal?this._lastVal:{x:0,y:0}},set:function(e){this._lastVal=e,this._lastValArea=e&&m(e,"-",m(p(this.DS.Area.rect),"+",p(this.DS.Area.computedBorder)))}}]),t}(),B=function(){function t(n){var r=this,s=n.DS,o=n.areaElement,a=n.zoom;e(this,t),i(this,"_initialVal",void 0),i(this,"_currentVal",void 0),i(this,"_areaElement",void 0),i(this,"_canScroll",void 0),i(this,"init",(function(){return r._areaElement.addEventListener("scroll",r.update)})),i(this,"start",(function(){r._currentVal=r._initialVal=b(r._areaElement),r._areaElement.addEventListener("scroll",r.update)})),i(this,"update",(function(){return r._currentVal=b(r._areaElement)})),i(this,"stop",(function(){r._areaElement.removeEventListener("scroll",r.update),r._initialVal={x:0,y:0},r._canScroll=null})),i(this,"reset",(function(){r.stop(),r.start()})),this._areaElement=o,this.DS=s,this.zoom=a,this.DS.subscribe("Interaction:init",this.init),this.DS.subscribe("Interaction:start",(function(){return r.start()})),this.DS.subscribe("Interaction:end",(function(){return r.reset()}))}return n(t,[{key:"canScroll",get:function(){return"boolean"==typeof this._canScroll?this._canScroll:this._canScroll=(e=this._areaElement,!!((t=b(e)).x||t.y||(e instanceof HTMLDocument?e.body?e.body.scrollTop=1:e.documentElement.scrollTop=1:e.scrollTop=1)));var e,t}},{key:"scrollAmount",get:function(){var e,t=m(this.currentVal,"-",this.initialVal),n={x:e=this.zoom,y:e},i=m(m(t,"*",n),"-",t);return{x:t.x+i.x,y:t.y+i.y}}},{key:"initialVal",get:function(){return this._initialVal?this._initialVal:{x:0,y:0}}},{key:"currentVal",get:function(){return this._currentVal||(this._currentVal=b(this._areaElement)),this._currentVal}}]),t}();return function(){function t(n){var r=this,s=n.area,o=void 0===s?document:s,a=n.selectables,l=void 0===a?[]:a,c=n.autoScrollSpeed,u=void 0===c?5:c,d=n.overflowTolerance,h=void 0===d?{x:25,y:25}:d,f=n.zoom,v=void 0===f?1:f,S=n.customStyles,m=void 0!==S&&S,p=n.multiSelectMode,g=void 0!==p&&p,y=n.multiSelectToggling,b=void 0===y||y,_=n.multiSelectKeys,D=void 0===_?["Control","Shift","Meta"]:_,k=n.selector,x=void 0===k?void 0:k,E=n.draggability,w=void 0===E||E,I=n.immediateDrag,P=void 0===I||I,A=n.dragKeys,j=n.keyboardDragSpeed,U=void 0===j?10:j,W=n.useTransform,F=void 0===W||W,Z=n.hoverClass,G=void 0===Z?"ds-hover":Z,X=n.selectableClass,Y=void 0===X?"ds-selectable":X,$=n.selectedClass,q=void 0===$?"ds-selected":$,J=n.selectorClass,Q=void 0===J?"ds-selector":J,ee=n.selectorAreaClass,te=void 0===ee?"ds-selector-area":ee,ne=n.callback,ie=n.onDragMove,re=n.onDragStartBegin,se=n.onDragStart,oe=n.onElementSelect,ae=n.onElementUnselect;e(this,t),i(this,"start",(function(){return r.Interaction.init()})),i(this,"getSelection",(function(){return r.SelectedSet.elements})),i(this,"getSelectables",(function(){return r.SelectableSet.elements})),i(this,"getInitialCursorPosition",(function(){return r.stores.PointerStore.initialVal})),i(this,"getCurrentCursorPosition",(function(){return r.stores.PointerStore.currentVal})),i(this,"getPreviousCursorPosition",(function(){return r.stores.PointerStore.lastVal})),i(this,"getInitialCursorPositionArea",(function(){return r.stores.PointerStore.initialValArea})),i(this,"getCurrentCursorPositionArea",(function(){return r.stores.PointerStore.currentValArea})),i(this,"getPreviousCursorPositionArea",(function(){return r.stores.PointerStore.lastValArea})),i(this,"isMultiSelect",(function(e){return r.stores.KeyStore.isMultiSelectKeyPressed(e)})),i(this,"isDragging",(function(){return r.Interaction.isDragging})),this.PubSub=new C,this.subscribe=this.PubSub.subscribe,this.unsubscribe=this.PubSub.unsubscribe,this.publish=this.PubSub.publish,this._callbacksTemp({callback:ne,onDragMove:ie,onDragStart:se,onDragStartBegin:re,onElementSelect:oe,onElementUnselect:ae}),this.stores={PointerStore:new z({DS:this}),ScrollStore:new B({DS:this,areaElement:o,zoom:v}),KeyStore:new R({DS:this,multiSelectKeys:D,multiSelectMode:g})},this.Area=new L({area:o,PS:this.PubSub,zoom:v}),this.Selector=new O({DS:this,selector:x,selectorClass:Q,customStyles:m}),this.SelectorArea=new H({DS:this,selectorAreaClass:te,autoScrollSpeed:u,overflowTolerance:h}),this.SelectableSet=new N({elements:l,DS:this,className:Y,hoverClassName:G}),this.SelectedSet=new M({DS:this,className:q}),this.Selection=new K({DS:this,hoverClassName:G,multiSelectToggling:b}),this.Drag=new T({DS:this,useTransform:F,dragKeys:Object.assign({up:["ArrowUp"],down:["ArrowDown"],left:["ArrowLeft"],right:["ArrowRight"]},A),keyboardDragSpeed:U}),this.Interaction=new V({areaElement:o,DS:this,draggability:w,immediateDrag:P}),this.subscribe("Selected:added",(function(e){var t=e.items,n=e.item;return r.publish("elementselect",{items:t,item:n,isDragging:r.Interaction.isDragging})})),this.subscribe("Selected:removed",(function(e){var t=e.items,n=e.item;return r.publish("elementunselect",{items:t,item:n,isDragging:r.Interaction.isDragging})})),this.subscribe("Interaction:update",(function(e){var t=e.event,n=e.data,i=e.isDragging;t&&!n&&r.publish("dragmove",{items:r.getSelection(),event:t,isDragging:i}),!t&&n&&r.publish("autoscroll",{data:n,isDragging:i})})),this.subscribe("Interaction:start",(function(e){var t=e.event,n=e.isDragging;return r.publish("dragstart",{items:r.getSelection(),event:t,isDragging:n})})),this.subscribe("Interaction:end",(function(e){var t=e.event,n=e.isDragging;return r.publish("callback",{items:r.getSelection(),event:t,isDragging:n})})),this.start()}return n(t,[{key:"_callbacksTemp",value:function(e){var t=e.callback,n=e.onDragMove,i=e.onDragStart,r=e.onDragStartBegin,s=e.onElementSelect,o=e.onElementUnselect,a=function(e,t){return console.warn("[DragSelect] ".concat(e,' is deprecated. Use DragSelect.subscribe("').concat(t,'", (callbackObject) => {}) instead. Act Now! See docs for more info'))};t&&(a("callback","callback"),this.subscribe("callback",(function(e){var n=e.items,i=(e.item,e.event);return t(n,i)}))),n&&(a("onDragMove","dragmove"),this.subscribe("dragmove",(function(e){e.items,e.item;var t=e.event;return n(t)}))),i&&(a("onDragStart","dragstart"),this.subscribe("dragstart",(function(e){e.items,e.item;var t=e.event;return i(t)}))),r&&(a("onDragStartBegin","dragstart"),this.subscribe("dragstart",(function(e){e.items,e.item;var t=e.event;return r(t)}))),s&&(a("onElementSelect","elementselect"),this.subscribe("elementselect",(function(e){e.items;var t=e.item,n=e.event;return s(t,n)}))),o&&(a("onElementUnselect","elementunselect"),this.subscribe("elementunselect",(function(e){e.items;var t=e.item,n=e.event;return o(t,n)})))}},{key:"stop",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0;n&&this.publish("callback",{items:this.getSelection()}),this.Interaction.stop(),this.Area.stop(),this.Drag.stop(),this.Selector.stop(),this.stores.KeyStore.stop(),this.stores.PointerStore.stop(),this.stores.ScrollStore.stop(),e&&this.SelectableSet.clear(),t&&this.SelectedSet.clear()}},{key:"addSelection",value:function(e,t,n){return this.SelectedSet.addAll(P(e)),n||this.addSelectables(e),t&&this.PubSub.publish("callback",{items:this.getSelection()}),this.getSelection()}},{key:"removeSelection",value:function(e,t,n){return this.SelectedSet.deleteAll(P(e)),n&&this.removeSelectables(e),t&&this.PubSub.publish("callback",{items:this.getSelection()}),this.getSelection()}},{key:"toggleSelection",value:function(e,t,n){var i=this;return P(e).forEach((function(r){return i.SelectedSet.has(r)?i.removeSelection(e,t,n):i.addSelection(e,t,n)})),t&&this.PubSub.publish("callback",{items:this.getSelection()}),this.getSelection()}},{key:"setSelection",value:function(e,t,n){return this.clearSelection(),this.addSelection(e,t,n),this.getSelection()}},{key:"clearSelection",value:function(e){return this.SelectedSet.clear(),e&&this.PubSub.publish("callback",{items:this.getSelection()}),this.getSelection()}},{key:"addSelectables",value:function(e,t){var n=P(e);return this.SelectableSet.addAll(n),t&&this.SelectedSet.addAll(n),e}},{key:"setSelectables",value:function(e,t,n){return this.removeSelectables(e,t),this.addSelectables(e,n)}},{key:"removeSelectables",value:function(e,t){return this.SelectedSet.clear(),t&&this.SelectedSet.clear(),e}},{key:"getCursorPositionDifference",value:function(e){var t=this.getCurrentCursorPosition(),n=e?this.getPreviousCursorPosition():this.getInitialCursorPosition();return m(t,"-",n)}}]),t}()}));